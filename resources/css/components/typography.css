@layer components {
  .tagline {
    @apply text-sm font-semibold uppercase tracking-wide sm:text-base;
  }

  .content-xl {
    @apply text-xl sm:text-2xl;
  }

  .content-lg {
    @apply text-lg sm:text-xl/8;
  }

  .content {
    @apply text-base sm:text-lg;
  }

  .content-sm {
    @apply text-sm sm:text-base;
  }

  .content-xs {
    @apply text-xs sm:text-sm;
  }

  /* --------------- Article Typography --------------- */

  /* Article layout hooks */
  main:has(.article-body) {
    justify-content: center;
    align-items: flex-start;
  }

  .site-grid:has(.article-body) {
    row-gap: 1rem;
  }

  /* <640px: enforce gutters for article pages */
  @media (max-width: 639px) {
    .site-grid:has(.article-body) {
      padding-inline: 1.5rem;
    }

    /* prevent double-gutters from the article container */
    .site-grid:has(.article-body) .article-body {
      padding-inline: 0;
    }
  }

  /* Article container */
  .article-body {
    container-type: inline-size;
    container-name: article-body;
    position: relative;
    max-width: 70ch;
    margin-inline: auto;
    padding-inline: 1.5rem;
  }

  /* Aside base */
  .article-aside {
    position: relative;
    display: block;

    margin-block: 1.5rem 1.75rem;
    margin-inline-start: 1.5rem;
    margin-inline-end: 0;

    max-width: 34ch;

    font-family: var(--font-serif-italic);
    font-size: 0.9rem;
    line-height: 1.5;
    font-style: italic;
    font-variant-numeric: normal;

    color: var(--color-success);
  }

  .article-aside > :first-child { margin-top: 0; }
  .article-aside > :last-child  { margin-bottom: 0; }

  /* ≥ 820px */
  @media (min-width: 51.25rem) {
    .article-aside {
      float: left;
      clear: left;

      width: 18rem;
      margin-block: 0.25rem 0;
      margin-inline-start: -1rem;
      margin-inline-end: 1.5rem;

      font-size: 0.85rem;
      line-height: 1.4;
    }
  }

  /* ≥ 930px */
  @media (min-width: 58.125rem) {
    .article-aside {
      width: 16rem;
      margin-inline-start: -3rem;
      margin-inline-end: 1.5rem;
    }
  }

  /* ≥ 1140px */
  @media (min-width: 71.25rem) {
    .article-aside {
      position: absolute;
      inset-block-start: 0;
      inset-inline-start: 0;

      width: 14rem;
      margin: 0;

      transform: translateX(-11rem);
    }
  }

  @supports (font-size: 1cqi) {
    @container article-body (inline-size > 40ch) {
      .article-aside {
        font-size: clamp(0.8rem, 1.8cqi, 0.95rem);
        line-height: 1.5;
      }
    }

    @container article-body (inline-size > 70ch) {
      .article-aside {
        position: absolute;
        inset-block-start: 0;
        inset-inline-start: 0;

        width: 12rem;
        transform: translateX(-14rem) translateY(12.5%);
        float: none;
        margin: 0;
      }
    }
  }
}

/* --------------- Tailwind Overrides --------------- */

.article-body {
  margin-block: clamp(2rem, 2rem + 3vw, 10rem)
                clamp(1.5rem, 2rem + 2vw, 7.5rem);
  row-gap: clamp(0.75em, 0.75em + 0.15vw, 0.925em);
}

@media (max-width: 639px) {
  .article-body {
    width: calc(100% - 3rem);
    margin-inline: auto;
  }
}

.article-body > figure.not-prose:has(.article-aside) + * {
  margin-top: clamp(-0.75em, -0.75em + -0.15vw, -0.925em);
}

.article-body.prose p {
  font-family: var(--font-serif);
  font-size: clamp(1rem, 0.75rem + 0.85vw, 1.35rem);
  line-height: clamp(1.5em, 1.5em + 0.3vw, 1.85em);
  font-kerning: normal;
  font-variant-ligatures: common-ligatures;
  font-optical-sizing: auto;
}

/* --------------- Commerce7 Overrides --------------- */

.site-grid .article-body p {
  margin: 0;
}
